<script type="text/javascript" src="/libs/jquery-1.6.3.min.js"></script>
<script type="text/javascript" src="/jsapi/jsapi_helper.js"></script>
<script type="text/javascript" src="/jsapi/jsapi_abstract_database.js"></script>
<script type="text/javascript" src="/jsapi/jsapi_database.js"></script>
<script type="text/javascript" src="/jsapi/jsapi_for_google_plus.js"></script>
<script type="text/javascript" src="/content_script_api_bridge.js"></script>
<script type="text/javascript" src="/background_controller.js"></script>
<script>
  var plus = new GooglePlusAPI();
  var init = false;
  plus.init(function(ok) {
    init = ok;
  });
  plus.refreshInfo();

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27041781-3']);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = 'https://ssl.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  function trackNukeClick() {
    _gaq.push(['_trackEvent', 'Nuke', 'Clicked']);
  }

  function trackReportSuccess(ok) {
    var s = ok ? 'Success' : 'Failure';
    _gaq.push(['_trackEvent', 'Reporting', s]);
  }

  function trackDeleteSuccess(ok) {
    var s = ok ? 'Success' : 'Failure';
    _gaq.push(['_trackEvent', 'Deleting', s]);
  }

  function trackBlockSuccess(ok) {
    var s = ok ? 'Success' : 'Failure';
    _gaq.push(['_trackEvent', 'Blocking', s]);
  }

  function trackDismissed() {
    _gaq.push(['_trackEvent', 'Dismissed', 'Dismissed']);
  }

</script>
<script>

function onRequest(request, sender, callback) {
    var n = request.name;
    ok = true;
    if (n == 'block') {
        plus.modifyBlocked(function(ok) {
          callback({'ok': ok});
          trackBlockSuccess(ok);
        }, [request.userId], true);
    } else if (n == 'getId') {
        var info = plus.getInfo();
        if (info) {
            callback({'id': plus.getInfo().id});
        } else {
            callback({})
        }
    } else if (n == 'settings') {
      callback({'hydrogen': localStorage['hydrogen'],
                'dismissed': localStorage['dismissed']});
    } else if (n == 'dismissed') {
      localStorage['dismissed'] = 'true';
      trackDismissed();
    } else if (n == 'nukeClick') {
        trackNukeClick();
    } else if (n == 'report') {
      console.log('will report: ' + request.userId);
        plus.reportProfile(function(ok) {
          callback({'ok': ok});
          trackReportSuccess(ok);
        }, request.userId);
    } else if (n == 'deleteComment') {
        console.log('will del: '+request.commentId);
        plus.deleteComment(function(ok) {
          callback({'ok': ok});
          trackDeleteSuccess(ok);
        }, request.commentId);
    }
};

// Wire up the listener.
chrome.extension.onRequest.addListener(onRequest);
</script>
